=Embedding Jaql=
<wiki:toc max_depth="3" />
It is possible to embed Jaql in programs written by different languages, e.g Java and python. Jaql provides very simple api for both java and python programmers, if you have some knowledge of Jaql syntax, you can easily embed Jaql in your program. This document introduces how to setup jaql environment when developing embedding programs, and some examples to demonstrate how one could work with Jaql. 

==Embedding Jaql in Java==

===Setup environment===
Typically, Jaql runs on a hadoop cluster, which we called cluster model, this requires you have a hadoop cluster (and hbase, if use any hbase related functions) environment, otherwise, you can launch Jaql in local model, which means all the tasks run locally.
We are not going to discuss how to setup a hadoop cluster(hbase) here, below links maybe useful. 
  * http://hadoop.apache.org/common/docs/current/cluster_setup.html
  * http://wiki.apache.org/hadoop/Hbase/10Minutes
Let's assume you've installed Hadoop 0.20.1 and hbase 0.20.0. Follow below steps, you can launch Jaql on a running hadoop cluster and connect to a hbase server. 

 # Create a Java project
 # Add the following jar files into the project's build path
    * jaql.jar
    * hadoop-0.20.1-core.jar
    * log4j-1.2.15.jar
    * commons-logging-1.0.4.jar
    * commons-logging-api-1.0.4.jar
    * hbase-0.20.0-core.jar
    * zookeeper-r785019-hbase-1329.jar
 # Add the following folder into the project's build path
           conf folder from Jaql source 
 # Add you hadoop conf folder into the project's build path, which includs hadoop configuration files, like core-site.xml, hdfs-site.xml and mapred-site.xml.

Note : Launch Jaql in local model, simply remove hadoop conf folder from project's build path. 
 
===Examples===
This chapter introduces you several simple example using Jaql for you to start with, more examples can be found in Jaql source.
Typically, first you are going to initialize a JaqlQuery instance by its constructor `JaqlQuery()`, then use `setQueryString()` to set input for jaql context, at last use `evaluate()` to evaluate the query statement, this function will return you a JsonValue. Alternatively, `iterator()` can also evaluate the statement but return you a JsonIterator.
Notice that, you can set variable holders in the input parameter,  by means of Jaql syntax, it's $varname, then use `setVar()` to set its value at runtime.
You can try out with below examples.
==== Write data into HDFS ====
{{{
package myclazz;

import com.ibm.jaql.json.type.JsonValue;
import com.ibm.jaql.json.util.JsonIterator;
import com.ibm.jaql.lang.JaqlQuery;

/**
 * This sample program demonstrates how to persist data into HDFS.
 * */
public class MyClazz1 implements IConstants{
	
	public static void main(String[] args) {
		try{
			MyClazz1 mc = new MyClazz1();
			mc.writePublishers();
		}catch(Exception ex){
			ex.printStackTrace();
		}
	}
	/**
	 * persists publishers data into HDFS
	 * */
	public void writePublishers() throws Exception {
		JaqlQuery jaql = new JaqlQuery();
		jaql.setQueryString(publisher + " -> write(hdfs('publishers'));");
		JsonIterator it = jaql.iterate();
		while(it.moveNext()){
			JsonValue v = it.current();
			System.out.println(v);
		}
		jaql.close();
	}
}
}}}

==== Read data from HDFS, and retrieve JsonValue data ====
{{{
package myclazz;

import com.ibm.jaql.json.type.JsonValue;
import com.ibm.jaql.lang.JaqlQuery;

/**
 * This sample program finds the country of a specified 
 * publishing house.
 * */
public class MyClazz2 {

	public static void main(String[] args) {
		try{
			MyClazz2 mc = new MyClazz2();
			JsonValue v = mc.getCountry("Scholastic");
			System.out.println(v);
		}catch(Exception ex){
			ex.printStackTrace();
		}
	}
	
	/**
	 * returns the country name of the specified publisher.
	 * 
	 * @param publisher The name of publishing house
	 * @return JsonValue
	 * */
	private JsonValue getCountry(String publisher) throws Exception {
		JaqlQuery jaql = new JaqlQuery();
		jaql.setQueryString("read(hdfs('publishers')) -> filter $.name == $name -> transform $.country;");
		jaql.setVar("$name", publisher);
		JsonValue jv = jaql.evaluate();
		jaql.close();
		return jv;
	}
}
}}}



==Embedding Jaql in Python==